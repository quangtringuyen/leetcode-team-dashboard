# Environment Variables Configuration Guide

This guide explains all environment variables used in the LeetCode Team Dashboard.

---

## üîë Quick Setup

Your `.env` file has already been created with:
- ‚úÖ **Secure SECRET_KEY** generated
- ‚úÖ **AWS S3 credentials** preserved
- ‚úÖ **FastAPI settings** configured
- ‚úÖ **Scheduler settings** ready

**You're ready to deploy!** Just run:
```bash
./deploy-nas.sh
```

---

## üìã Environment Variables Explained

### üîê Security (REQUIRED)

```bash
SECRET_KEY=your-generated-secret-key-here
```

**What it does:** Signs JWT tokens for authentication
**Required:** ‚úÖ YES - without this, the API won't work
**Security:** ‚ö†Ô∏è NEVER commit this to git or share publicly
**How to generate:**
```bash
python3 -c "import secrets; print(secrets.token_urlsafe(32))"
```

---

### ‚òÅÔ∏è AWS S3 Storage (OPTIONAL)

```bash
AWS_ACCESS_KEY_ID=your_aws_access_key_here1
AWS_SECRET_ACCESS_KEY=your_aws_secret_key_here
AWS_DEFAULT_REGION=ap-southeast-1
S3_BUCKET_NAME=your-bucket-name
S3_PREFIX=prod
```

**What it does:** Stores data in AWS S3 instead of local files
**Required:** ‚ùå NO - leave empty to use local file storage
**When to use:**
- ‚úÖ Multiple servers/instances
- ‚úÖ Cloud deployment
- ‚úÖ Automatic backups via S3
- ‚úÖ Scalable storage

**When NOT to use:**
- ‚ùå Single NAS deployment (local files work great)
- ‚ùå Don't have AWS account
- ‚ùå Want to avoid AWS costs

**Current setup:** You have S3 configured, data will be stored in S3.

**To switch to local files:** Simply comment out or remove AWS credentials:
```bash
# AWS_ACCESS_KEY_ID=
# AWS_SECRET_ACCESS_KEY=
```

---

### ‚öôÔ∏è Application Settings

```bash
ENVIRONMENT=production
LOG_LEVEL=info
```

**ENVIRONMENT:**
- `production` - Production mode (default)
- `development` - Development mode with more logging
- `staging` - Staging environment

**LOG_LEVEL:**
- `debug` - Very detailed logs (use for troubleshooting)
- `info` - Normal logs (recommended)
- `warning` - Only warnings and errors
- `error` - Only errors

---

### üåê CORS Origins

```bash
CORS_ORIGINS=http://localhost:3000,http://localhost:8000,http://localhost:8501
```

**What it does:** Allows frontend apps to access the API
**Current setup:**
- `localhost:3000` - For React/Next.js frontend (default dev port)
- `localhost:8000` - API itself (for testing via Swagger)
- `localhost:8501` - Legacy Streamlit app (if you still use it)

**When to update:**
Add your frontend URL when you deploy:
```bash
CORS_ORIGINS=http://localhost:3000,https://yourdomain.com,http://192.168.1.100:3000
```

---

### üîí JWT Token Settings

```bash
ACCESS_TOKEN_EXPIRE_MINUTES=10080
```

**What it does:** How long until users need to login again
**Current:** 10080 minutes = 7 days
**Recommendations:**
- Development: 10080 (7 days) - convenient
- Production: 1440 (1 day) - more secure
- High security: 60 (1 hour) - very secure

**Change example:**
```bash
ACCESS_TOKEN_EXPIRE_MINUTES=1440  # 24 hours
```

---

### ‚è∞ Scheduler Settings

```bash
RUN_ON_STARTUP=false
```

**What it does:** Whether to capture data immediately when scheduler starts
**Options:**
- `false` - Wait until scheduled time (Monday midnight)
- `true` - Capture data immediately on startup, then follow schedule

**When to use `true`:**
- ‚úÖ Testing the scheduler
- ‚úÖ First deployment (want immediate data)
- ‚úÖ Just added many new members

**When to use `false`:**
- ‚úÖ Production (normal operation)
- ‚úÖ Let it run on schedule only

---

### üìÅ File Paths (OPTIONAL)

```bash
# USERS_FILE=data/users.json
# MEMBERS_FILE=data/members.json
# HISTORY_FILE=data/history.json
# SNAPSHOTS_FILE=data/snapshots.json
```

**What it does:** Custom file locations for data storage
**Default:** All files stored in `data/` directory
**Required:** ‚ùå NO - defaults work fine

**Only customize if:**
- You want to store data in a different location
- You're running multiple instances with different data

---

## üéØ Common Configurations

### Configuration 1: Local NAS with S3

```bash
# S3 Storage
AWS_ACCESS_KEY_ID=your_aws_access_key
AWS_SECRET_ACCESS_KEY=your_aws_secret_key
S3_BUCKET_NAME=your-bucket-name

# Security
SECRET_KEY=your-generated-secret-key

# Production settings
ENVIRONMENT=production
RUN_ON_STARTUP=false
```

**Use case:** NAS deployment with cloud backup to S3

---

### Configuration 2: Local NAS with Local Files Only

```bash
# NO AWS credentials = local file storage
# AWS_ACCESS_KEY_ID=
# AWS_SECRET_ACCESS_KEY=

# Security
SECRET_KEY=your-generated-secret-key

# Production settings
ENVIRONMENT=production
RUN_ON_STARTUP=false
```

**Use case:** Simple NAS deployment, all data stored locally in `data/` folder

---

### Configuration 3: Development Setup

```bash
# Local files
# AWS_ACCESS_KEY_ID=

# Security
SECRET_KEY=dev-secret-key-change-in-production

# Development settings
ENVIRONMENT=development
LOG_LEVEL=debug
RUN_ON_STARTUP=true  # Get data immediately
ACCESS_TOKEN_EXPIRE_MINUTES=10080  # 7 days
```

**Use case:** Local development on your computer

---

## üîÑ Switching Storage Modes

### Currently Using S3 ‚Üí Switch to Local Files

1. Edit `.env` and comment out AWS credentials:
```bash
# AWS_ACCESS_KEY_ID=
# AWS_SECRET_ACCESS_KEY=
# S3_BUCKET_NAME=
```

2. Restart services:
```bash
docker compose -f docker-compose.backend.yml restart
```

3. Data will now be stored in `./data/` directory

---

### Currently Using Local Files ‚Üí Switch to S3

1. Edit `.env` and add AWS credentials:
```bash
AWS_ACCESS_KEY_ID=your_key
AWS_SECRET_ACCESS_KEY=your_secret
S3_BUCKET_NAME=your-bucket
```

2. Restart services:
```bash
docker compose -f docker-compose.backend.yml restart
```

3. Data will now be stored in S3

---

## üîê Security Best Practices

### ‚úÖ DO:
- ‚úÖ Generate unique SECRET_KEY for each environment
- ‚úÖ Keep `.env` file secure (it's in `.gitignore`)
- ‚úÖ Use strong, random SECRET_KEY (32+ characters)
- ‚úÖ Rotate SECRET_KEY periodically
- ‚úÖ Use different keys for dev/staging/production

### ‚ùå DON'T:
- ‚ùå Commit `.env` to git
- ‚ùå Share SECRET_KEY publicly
- ‚ùå Use simple/guessable SECRET_KEY
- ‚ùå Use the same key across environments
- ‚ùå Store credentials in code

---

## üß™ Testing Your Configuration

### 1. Verify .env is loaded

```bash
# Start the API
docker compose -f docker-compose.backend.yml up -d

# Check logs for errors
docker compose -f docker-compose.backend.yml logs api | grep ERROR
```

No errors = configuration is valid ‚úÖ

### 2. Test Storage Mode

**Check if using S3 or local:**
```bash
docker compose -f docker-compose.backend.yml logs api | grep -i storage
```

You should see either:
- "Using S3 storage" (if AWS credentials present)
- "Using local file storage" (if no AWS credentials)

### 3. Test JWT Token

```bash
# Register a user
curl -X POST http://localhost:8000/api/auth/register \
  -H "Content-Type: application/json" \
  -d '{"username":"testuser","email":"test@example.com","password":"test123"}'

# Login
curl -X POST http://localhost:8000/api/auth/login \
  -H "Content-Type: application/x-www-form-urlencoded" \
  -d "username=testuser&password=test123"
```

If you get an `access_token` back, JWT is working ‚úÖ

---

## üÜò Troubleshooting

### Error: "SECRET_KEY is required"

**Problem:** SECRET_KEY not set or empty

**Solution:**
```bash
# Generate new key
python3 -c "import secrets; print(secrets.token_urlsafe(32))"

# Add to .env
SECRET_KEY=<generated-key>

# Restart
docker compose -f docker-compose.backend.yml restart
```

---

### Error: "Could not connect to S3"

**Problem:** Invalid AWS credentials or bucket doesn't exist

**Solutions:**

**Option 1:** Fix AWS credentials
- Verify AWS_ACCESS_KEY_ID is correct
- Verify AWS_SECRET_ACCESS_KEY is correct
- Verify S3_BUCKET_NAME exists in your AWS account
- Check AWS_DEFAULT_REGION matches bucket region

**Option 2:** Switch to local files
```bash
# Comment out AWS credentials in .env
# AWS_ACCESS_KEY_ID=
# Restart services
docker compose -f docker-compose.backend.yml restart
```

---

### Error: CORS errors in browser

**Problem:** Frontend domain not in CORS_ORIGINS

**Solution:**
```bash
# Add your frontend URL to .env
CORS_ORIGINS=http://localhost:3000,https://yourdomain.com

# Restart
docker compose -f docker-compose.backend.yml restart
```

---

## üìö Related Documentation

- **[QUICK_START.md](QUICK_START.md)** - Get started in 60 seconds
- **[README.Docker.md](README.Docker.md)** - Docker deployment guide
- **[NAS_DEPLOYMENT_GUIDE.md](NAS_DEPLOYMENT_GUIDE.md)** - NAS-specific setup

---

## ‚úÖ Your Current Configuration Summary

Based on your `.env` file:

- **Storage Mode:** ‚úÖ AWS S3 (configured)
- **SECRET_KEY:** ‚úÖ Generated and secure
- **Environment:** production
- **JWT Expiration:** 7 days
- **Scheduler on startup:** No (waits for Monday midnight)
- **CORS:** Configured for localhost development

**Status:** üéâ Ready to deploy!

Run `./deploy-nas.sh` to get started!
